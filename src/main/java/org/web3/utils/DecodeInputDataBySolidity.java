package org.web3.utils;

import java.util.ArrayList;
import java.util.List;

import org.web3j.abi.FunctionReturnDecoder;
import org.web3j.abi.TypeReference;
import org.web3j.abi.datatypes.DynamicBytes;
import org.web3j.abi.datatypes.Type;
import org.web3j.abi.datatypes.generated.Uint256;
import org.web3j.model.IBSwapAggregator.SwapDataInfo;

import io.github.cdimascio.dotenv.Dotenv;

public class DecodeInputDataBySolidity {

    static Dotenv dotenv = Dotenv.load();
    static String RPC = dotenv.get("ALCHEMY_SEPOLIA_URL");

    public static void main(String[] args) {

        String inputData_swapExactInput = "0x387afc090000000000000000000000000000000000000000000000000000000000000020000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000000000000000000000000000000000000001cbe87f00000000000000000000000068749665ff8d2d112fa859aa293f07a622782f380000000000000000000000000000000000000000000000000000000000001c30000000000000000000000000000000b1cf3c8df89d748dcbea3c970e1bcf403900000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000060000000000000000000000006a000f20005980200259b80c5102003040001068000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000204876a02f60000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec700000000000000000000000068749665ff8d2d112fa859aa293f07a622782f380000000000000000000000000000000000000000000000000000000001cbe87f0000000000000000000000000000000000000000000000000000000000001c2f0000000000000000000000000000000000000000000000000000000000001c546503d66ddead4766af378d0a955d15a4000000000000000000000000016ca09f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000006000000000000000000000000068749665ff8d2d112fa859aa293f07a622782f38000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec700000000000000000000000000000000000000000000000000000000000001f4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

        SwapDataInfo swapDataInfo = decodeSwapDataInfo(inputData_swapExactInput);
        System.out.println("swapExactInput");

        System.out.println("TokenIn:" + swapDataInfo.tokenIn);
        System.out.println("AmountIn:" + swapDataInfo.amountIn);
        System.out.println("TokenOut:" + swapDataInfo.tokenOut);
        System.out.println("MinOut:" + swapDataInfo.minOut);

        String inputData_swapExactInputWithPermit2 = "0x19d180ca000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000692ff21d00000000000000000000000000000000000000000000000000000000692ff925000000000000000000000000000000000000000000000000000000000000090000000000000000000000000068749665ff8d2d112fa859aa293f07a622782f380000000000000000000000000000000000000000000000000000000000001c54000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000000000000000000000000000000000000001ce280f000000000000000000000000000000b1cf3c8df89d748dcbea3c970e1bcf403900000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000060000000000000000000000006a000f20005980200259b80c5102003040001068000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000704e3ead59e000000000000000000000000000010036c0190e009a000d0fc3541100a07380a00000000000000000000000068749665ff8d2d112fa859aa293f07a622782f38000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000000000000000000000000000000000000000001c540000000000000000000000000000000000000000000000000000000001ce280e0000000000000000000000000000000000000000000000000000000001d07a970f7912786657431fb00ae01d8c5cb043000000000000000000000000016d2b170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000056068749665ff8d2d112fa859aa293f07a622782f380000006000240000ff00000300000000000000000000000000000000000000000000000000000000a9059cbb00000000000000000000000066a9893cc07d91d95644aedd05d03f95e1dba8af0000000000000000000000000000000000000000000000000000000000001c5466a9893cc07d91d95644aedd05d03f95e1dba8af0000048002e40000ff0000030000000000000000000000000000000000000000000000000000000024856bc30000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000380000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003060b0e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000002000000000000000000000000068749665ff8d2d112fa859aa293f07a622782f38000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec700000000000000000000000000000000000000000000000000000000000001b80000000000000000000000000000000000000000000000000000000000000009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000001c54000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000068749665ff8d2d112fa859aa293f07a622782f38000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000006a000f20005980200259b80c510200304000106800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000411de02903e2915e1c600be95284188762c8180f7a84559f5cbcde806f01af6b6565adb8cd35684a0109535fc028cddd21b3b5d305ee919d7e836ae2c35540e7b01c00000000000000000000000000000000000000000000000000000000000000";

        SwapDataInfo swapDataInfo2 = decodeSwapDataInfo(inputData_swapExactInputWithPermit2);
        System.out.println("swapExactInputWithPermit2");

        System.out.println("TokenIn:" + swapDataInfo2.tokenIn);
        System.out.println("AmountIn:" + swapDataInfo2.amountIn);
        System.out.println("TokenOut:" + swapDataInfo2.tokenOut);
        System.out.println("MinOut:" + swapDataInfo2.minOut);

    }

    public static SwapDataInfo decodeSwapDataInfo(String inputData) {

        String selector = inputData.substring(0, 10);

        String data = "0x" + inputData.substring(10);

        List<TypeReference<Type>> outputParameters = new ArrayList<>();

        SwapDataInfo swapDataInfo;

        // swapExactInput (0x387afc09)
        // swapExactInputWithPermit (0xe13bad9d)
        // swapExactInputWithPermit2 (0x19d180ca)
        if (selector.toLowerCase().equals("0x387afc09")) {
            outputParameters.add((TypeReference) new TypeReference<SwapDataInfo>() {
            });

            List<Type> decoded = FunctionReturnDecoder.decode(data, outputParameters);

            swapDataInfo = (SwapDataInfo) decoded.get(0);

            return swapDataInfo;
        } else if (selector.toLowerCase().equals("0x19d180ca")) {
            outputParameters.add((TypeReference) new TypeReference<SwapDataInfo>() {
            });
            // nonce
            outputParameters.add((TypeReference) new TypeReference<Uint256>() {
            });
            // deadline
            outputParameters.add((TypeReference) new TypeReference<Uint256>() {
            });
            // signature
            outputParameters.add((TypeReference) new TypeReference<DynamicBytes>() {
            });

            List<Type> decoded = FunctionReturnDecoder.decode(data, outputParameters);

            swapDataInfo = (SwapDataInfo) decoded.get(0);
            return swapDataInfo;
        } else if (selector.toLowerCase().equals("0xe13bad9d")) {
            outputParameters.add((TypeReference) new TypeReference<SwapDataInfo>() {
            });
            // deadline
            outputParameters.add((TypeReference) new TypeReference<Uint256>() {
            });
            // signature
            outputParameters.add((TypeReference) new TypeReference<DynamicBytes>() {
            });

            List<Type> decoded = FunctionReturnDecoder.decode(data, outputParameters);

            swapDataInfo = (SwapDataInfo) decoded.get(0);
            return swapDataInfo;
        }

        return null;

    }

}
